## π“– REST & Idempotency
> RESTλ” λ‹¨μ URL κ·μΉ™μ΄ μ•„λ‹λΌ, μ›Ήμ λ¶„μ‚° μ•„ν‚¤ν…μ²λ¥Ό μ„ν• **6κ°€μ§€ μ μ•½ μ΅°κ±΄(Architectural Constraints)**κ³Ό HTTP κΈ°λ° μ„¤κ³„ μ›μΉ™μ„ ν¬ν•¨ν• μ•„ν‚¤ν…μ² μ¤νƒ€μΌ

---
### 1. RESTμ 6κ°€μ§€ μ›μΉ™ (Architectural Constraints)
| μ›μΉ™ | ν•µμ‹¬ κ°λ…  | μλ―Έ |
| --| -- | -- |
| **Stateless** | μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈ μƒνƒλ¥Ό μ €μ¥ν•μ§€ μ•μ | μ„λ²„ μƒνƒλ¥Ό λ¨λ¥΄λ―€λ΅ **μν‰ ν™•μ¥(Scale-out)** μ‰¬μ›€. μ”μ²­ μ¬μ‹λ„ κ°€λ¥ |
| **Uniform Interface** | λ¦¬μ†μ¤ μ‹λ³„ + λ©”μ‹μ§€λ¥Ό ν†µν• μ΅°μ‘| ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„ λ…λ¦½μ  μ§„ν™” κ°€λ¥. **HATEOAS ν¬ν•¨**  |
| **Client-Server**| UIμ™€ λ°μ΄ν„° κ΄€λ¦¬ λ¶„λ¦¬| μ–Έμ–΄, ν”λ«νΌμ— κµ¬μ• λ°›μ§€ μ•κ³  κµ¬ν„ κ°€λ¥|
| **Cacheable** | μ‘λ‹µ μΊμ‹ μ—¬λ¶€ λ…μ‹ | `ETag`, `Cache-Control` ν™μ© β†’ μ„λ²„ λ¶€ν• κ°μ†, λ„¤νΈμ›ν¬ μ μ•½ |
| **Layered System** | μ¤‘κ°„ κ³„μΈµ ν—μ© (ν”„λ΅μ‹, κ²μ΄νΈμ›¨μ΄) | ν΄λΌμ΄μ–ΈνΈλ” μ§μ ‘ μ—°κ²°μΈμ§€ μ• ν•„μ” μ—†μ β†’ λ³΄μ•/ν™•μ¥μ„± ν–¥μƒ |
| **Code on Demand**| (μ„ νƒ) μ‹¤ν–‰ κ°€λ¥ν• μ½”λ“ μ „μ†΅ | λΈλΌμ°μ €μ—μ„ μ¤ν¬λ¦½νΈ μ‹¤ν–‰μΌλ΅ κΈ°λ¥ ν™•μ¥ κ°€λ¥ |

> π”‘ Stateless : μ„Έμ… μƒνƒλ¥Ό μ €μ¥ν•μ§€ μ•μ. 
---
### 2. HTTP Methodμ μ•μ •μ„±(Safe)κ³Ό λ©±λ“±μ„±(Idempotent)
| Method  | Safe  | Idempotent  | URI μ‚¬μ© ν¨ν„΄   | μ„¤κ³„ ν¬μΈνΈ  |
| --| -- | -- | -- | -- |
| **GET** | β… | β… | λ¦¬μ†μ¤ μ΅°ν: `/users`, `/users/{id}` | μΊμ‹± ν™μ© ν•„μ, ν•„ν„°λ§/νμ΄μ§• μ„¤κ³„ μ¤‘μ”, query parameterλ΅ κ²€μƒ‰/μ •λ ¬ μ²λ¦¬|
| **POST** | β | β | λ¦¬μ†μ¤ μƒμ„±: `/users`, `/orders`| μ¤‘λ³µ μ”μ²­ λ°©μ§€ μ„ν•΄ **Idempotency Key** ν•„μ, λ°°μΉ μ”μ²­ λ° λΉ„λ™κΈ° μ²λ¦¬ κ³ λ ¤|
| **PUT** | β| β… | λ¦¬μ†μ¤ μ „μ²΄ κµμ²΄: `/users/{id}`| μ΅΄μ¬ν•μ§€ μ•μΌλ©΄ Upsert μ²λ¦¬ κ°€λ¥, μ¬μ‹λ„ κ°€λ¥, μ „μ²΄ λ¦¬μ†μ¤ λ®μ–΄μ“°κΈ°|
| **PATCH** | β | β  Usually No | λ¦¬μ†μ¤ μΌλ¶€ μμ •: `/users/{id}` | λ¶€λ¶„ μ—…λ°μ΄νΈ. μ—°μ‚°ν•(Patch +1 λ“±) μ‹ λ©±λ“± κΉ¨μ§. JSON Patch(RFC 6902) ν™μ© |
| **DELETE** | β | β… | λ¦¬μ†μ¤ μ‚­μ : `/users/{id}`| μ¬μ‹λ„ μ‹ 404/204 μƒνƒ μ μ§€. Soft delete/Hard delete μ „λµ ν•„μ”|

> π”‘ Idempotency Key (λ©±λ“± ν‚¤): 
> - POST μ”μ²­ μ¤‘λ³µ λ°©μ§€ ν•„μ (μ: κ²°μ /μ£Όλ¬Έ)
> - ν—¤λ”μ— κ³ μ  ν‚¤(UUID) μ „λ‹¬ β†’ μ„λ²„κ°€ μ¤‘λ³µ μ”μ²­ κ±Έλ¬ μ²λ¦¬
> - **λ©±λ“±μ„±** : μ—¬λ¬ λ² μν–‰ν•΄λ„ κ²°κ³Όκ°€ μ²μ ν• λ² ν–μ„ λ•μ™€ κ°™μ€ μ„±μ§

#### 2.1. POST vs PUT
|κµ¬λ¶„|POST (Create/Append)|PUT (Replace/Upsert)|
|--|--|--|
|λ¦¬μ†μ¤ ID|μ„λ²„κ°€ κ²°μ •ν•¨ (μ: AUTO_INCREMENT ID)|ν΄λΌμ΄μ–ΈνΈκ°€ κ²°μ •ν•¨ (μ: UUID, μ΄λ©”μΌ)|
|URI ν•νƒ|/users (Collectionμ— μ¶”κ°€)|/users/john@email.com (ν•΄λ‹Ή μ„μΉλ¥Ό λ®μ–΄μ”€)|
|λ©±λ“±μ„±|β (μ—°νƒ€ν•λ©΄ λ°μ΄ν„°κ°€ μ—¬λ¬ κ° μƒκΉ€)|β… (μ—°νƒ€ν•΄λ„ λ‘κ°™μ€ λ°μ΄ν„°λ΅ λ®μ–΄μ¨μ§)|
|λΉ„μ |κ²μ‹νμ— μƒ κΈ€ μ“°κΈ° (λ²νΈλ” μ„λ²„κ°€ λ§¤κΉ€)|νΉμ • μΉΈμ— μ‚¬μ§„ λΌμ›λ„£κΈ° (μ΄λ―Έ μλ¦¬κ°€ μ •ν•΄μ Έ μμ)|

#### 2.2. DELETE
- DELETEλ” λ³΄ν†µ Path Parameterλ¥Ό μ‚¬μ©ν•λ‹¤.
- λ‹¤λ§, μ—¬λ¬ λ¦¬μ†μ¤λ¥Ό μ΅°κ±΄λ¶€ μ‚­μ  μ‹ Query Parameter μ‚¬μ© κ°€λ¥
- μΌλ°μ μΌλ΅ Soft Delete + Path Parameter μ΅°ν•©

---
### 3. URI μ„¤κ³„ κ°€μ΄λ“
| κµ¬λ¶„ | μ©λ„ | μμ‹ | ν¬μΈνΈ |
| -- | -- | -- | -- |
| **Path Parameter**| λ¦¬μ†μ¤ μ‹λ³„, μ‚­μ  | `/users/{id}`, `/users/{id}/orders`| RESTful μ„¤κ³„: λ…μ‚¬ μ¤‘μ‹¬, κ³„μΈµμ  κµ¬μ΅° |
| **Query Parameter** | κ²€μƒ‰, ν•„ν„°, νμ΄μ§• | `/users?status=active&page=2&` | μµμ…/ν•„μ κµ¬λ¶„ λ…ν™•, κΈ°λ³Έκ°’ μ κ³µ, HATEOASμ™€ κ²°ν•© κ°€λ¥ |
| **λ²„μ „ κ΄€λ¦¬** | μ—”λ“ν¬μΈνΈ λ³€κ²½ λ€μ‘ | `/v1/users`, Header: `Accept: application/vnd.company.v1+json` | Backward compatibility μ μ§€ ν•„μ |

---
### 4. HATEOAS (Hypermedia as the Engine of Application State)
- ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„ URL κµ¬μ΅°λ¥Ό λ°λΌλ„, μ‘λ‹µ λ§ν¬λ¥Ό λ”°λΌ API νƒμƒ‰ κ°€λ¥
- μΌλ°μ μΈ RESTμ—μ„λ” ν΄λΌμ΄μ–ΈνΈκ°€ URLμ„ ν•λ“μ½”λ”© β†’ μ—”λ“ν¬μΈνΈ λ³€κ²½ μ‹ ν΄λΌμ΄μ–ΈνΈλ„ μμ • ν•„μ”
- HATEOASλ” μ„λ²„κ°€ μ‘λ‹µμ— **λ‹¤μ κ°€λ¥ν• μ•΅μ…/λ§ν¬**λ¥Ό ν¬ν•¨
- μμ‹
    ```json
    {
        "id": 123,
        "name": "John",
        "links": [
            {"rel": "self", "href": "/users/123"},
            {"rel": "orders", "href": "/users/123/orders"}
        ]
    }
    ```
---
### 5. μΊμ‹± λ° μƒνƒ κ΄€λ¦¬
| κ°λ… | μ„¤λ… | ν¬μΈνΈ |
| -- | -- | -- |
| **Stateless** | μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈ μƒνƒ μ €μ¥ μ• ν•¨ | μ¬μ‹λ„/λ΅λ“λ°Έλ°μ‹± μ©μ΄, μ„λ²„ ν™•μ¥ μ‰¬μ›€|
| **Cacheable** | μ‘λ‹µ μΊμ‹ μ—¬λ¶€ ν‘μ‹  | GET μ‘λ‹µμ— `ETag`, `Last-Modified`, `Cache-Control` ν™μ© |
| **Conditional Request** | 304 Not Modified ν™μ© | μ„λ²„ λ¶€ν• κ°μ†, λ„¤νΈμ›ν¬ μ μ•½ |

---
### 6. Error Handling & μ¬μ‹λ„ μ „λµ
| ν•­λ© | μ„¤λ…  | ν¬μΈνΈ 
| -- | --- | -- |
| HTTP μƒνƒ μ½”λ“ | ν‘μ¤€ν™”: 200, 201, 204, 400, 404, 409, 500 λ“± | ν΄λΌμ΄μ–ΈνΈ μ¬μ‹λ„ μ—¬λ¶€ κ²°μ •|
| Retry μ „λµ | Safe/Idempotent μ”μ²­λ§ μ¬μ‹λ„ | POSTλ” Idempotency Key ν•„μ, PATCH μ¬μ‹λ„ μ—¬λ¶€ ν™•μΈ |
| Rate Limiting | ν΄λΌμ΄μ–ΈνΈ κ³Όλ„ν• μ”μ²­ λ°©μ§€ | 429 Too Many Requests + Retry-After μ κ³µ |

#### 6.1. Error Code
| μ½”λ“  | μλ―Έ |
| --- | ----|
| 200 | OK, μ”μ²­ μ„±κ³µ  |
| 201 | Created, μ”μ²­ μ„±κ³µ + λ¦¬μ†μ¤ μƒμ„±. Location ν—¤λ”μ— μƒ μ£Όμ† ν¬ν•¨ ν•„μ |
| 202 | Accepted, μ”μ²­ μ ‘μλμΌλ‚ μ²λ¦¬ μ§€μ—°. λΉ„λ™κΈ°/λ°°μΉ μ‘μ—… μ‹ μ‚¬μ©         |
| 204 | No Content, μ”μ²­ μ„±κ³µν–μΌλ‚ λ°ν™ν•  λ°μ΄ν„° μ—†μ (μ£Όλ΅ DELETE μ„±κ³µ μ‹) |
| 400 | Bad Request, μ”μ²­ κ·κ²©(JSON λ“±) μμ²΄ μ¤λ¥                 |
| 401 | Unauthorized, μΈμ¦ μ‹¤ν¨                              |
| 403 | Forbidden, κ¶ν• μ—†μ                                 |
| 404 | Not Found, λ¦¬μ†μ¤ μ—†μ                                |
| 409 | Conflict, λ°μ΄ν„° μ¶©λ (μ: μ΄λ―Έ μ΅΄μ¬ν•λ” μ•„μ΄λ””)                |
| 422 | Unprocessable Entity, λ¬Έλ²•μ€ λ§μ§€λ§ λΉ„μ¦λ‹μ¤ κ·μΉ™ μ„λ°         |
| 429 | Too Many Requests, Rate Limit μ΄κ³Ό                 |
| 500 | Internal Server Error, μ„λ²„ μ¤λ¥                     |

---
### 7. λ©±λ“±μ„± λ³΄μ¥ μ „λµ
| μ „λµ | κµ¬ν„ λ°©μ‹  | νΉμ§• |
| --| -- | --- |
| **Idempotency Key** | ν΄λΌμ΄μ–ΈνΈ μ”μ²­ ν—¤λ”μ— UUID μ „λ‹¬ β†’ μ„λ²„ μ €μ¥μ†(Redis λ“±) ν™•μΈ  | POST μ¤‘λ³µ λ°©μ§€, μ¬μ‹λ„ μ•μ „. TTL μ„¤μ • ν•„μ|
| **Database μ μ•½ μ΅°κ±΄**  | Unique Constraint ν™μ© (μ: order_number, user_id + product_id) | DB μμ¤€μ—μ„ μ¤‘λ³µ μ”μ²­ μ›μ² μ°¨λ‹¨  |
| **μ΅°κ±΄λ¶€ μ—…λ°μ΄νΈ** | PATCH/PUT μ‹ λ²„μ „ μ²΄ν¬ (Optimistic Locking) | μ²« μ”μ²­ μ„±κ³µ ν›„ λ²„μ „ μ¦κ°€ β†’ μ¤‘λ³µ μ”μ²­ μ‹¤ν¨. λ©±λ“±μ„± μ μ§€ |
| **νƒ€μ„μ•„μ›ƒ / TTL κ΄€λ¦¬** | Idempotency Key μ €μ¥ κΈ°κ°„ μ ν•  | μ„λ²„ λ©”λ¨λ¦¬/DB λ¶€λ‹΄ μ™„ν™”  |
| **λΉ„μ¦λ‹μ¤ λ΅μ§ λ‹¨μ„ν™”**  | μ”μ²­ λ‹¨μ„λ¥Ό κ°€λ¥ν• ν• μ‘μ€ νΈλμ­μ…μΌλ΅ μν–‰  | λ¶€λ¶„ μ‹¤ν¨ μ‹ λ΅¤λ°± κ°€λ¥ β†’ μΌκ΄€μ„± μ μ§€|
| **μ¬μ‹λ„ μ •μ±… μ—°κ³„** | Safe/Idempotent μ”μ²­λ§ μ¬μ‹λ„ | POSTλ” Key ν•„μ”, PATCH/PUT μ¬μ‹λ„ μ—¬λ¶€ ν™•μΈ  |
| **κ²°κ³Ό μΊμ‹± / λ°ν™**   | μ΄λ―Έ μ²λ¦¬λ μ”μ²­μ€ μ΄μ „ κ²°κ³Ό λ°ν™  | ν΄λΌμ΄μ–ΈνΈλ” μ¤‘λ³µ μ”μ²­μ„ μ²λ¦¬ν•  ν•„μ” μ—†μ |
---
#### π’΅ Summary
1. **λ©±λ“± ν‚¤(Idempotency Key)μ μλ…**: Redisμ— μ €μ¥ν•  λ• λΉ„μ¦λ‹μ¤ νΉμ„±μ— λ”°λΌ TTL(μ ν¨κΈ°κ°„)μ„ λ‹¤λ¥΄κ² μ„¤μ •. (κ²°μ λ” κΈΈκ², μΌλ° μμ •μ€ μ§§κ²)
2. **μ—λ¬ λ°”λ””(Error Body)μ μΉμ ν•¨**: 400 μ—λ¬λ¥Ό μ¤„ λ• λ‹¨μν μ½”λ“λ§ μ£Όμ§€ λ§κ³ , `{"code": "INVALID_EMAIL", "message": "μ΄λ©”μΌ ν•μ‹μ΄ μλ»λμ—μµλ‹λ‹¤"}`μ²λΌ κµ¬μ²΄μ μΌλ΅ μ•λ ¤μ¤μ•Ό ν•¨.
3. **Soft Delete vs Hard Delete**: DELETE λ©”μ„λ“ μ‹ μ§„μ§ λ°μ΄ν„°λ¥Ό μ§€μΈμ§€(Hard), `is_deleted` ν•„λ“λ§ λ°”κΏ€μ§€(Soft) ν€ λ‚΄ μ „λµμ„ λ…ν™•ν.
---
### Suppl. API μ„¤κ³„ μ‹ λ‹¨κ³„λ³„ κ³ λ ¤ μ‚¬ν•­
| λ‹¨κ³„ | μ‚¬κ³  κ³Όμ •| ν•λ“μ›¨μ–΄/DB κ΄€μ  μ΄μ  | κ΄€λ ¨ κΈ°μ  / ν‚¤μ›λ“|
| -- | -- | --- | -- |
| **1. μ§„μ…λ΅ λ°©μ–΄** | "μ΄ μ”μ²­μ„ λ³΄λ‚Έ λ†μ΄ κ³µκ²©μμΈκ°€? λ„λ¬΄ λ§μ΄ λ³΄λ‚΄μ§„ μ•λ‚?"  | CPU μΈν„°λ½νΈ ν­μ£Ό λ°©μ§€, λ„¤νΈμ›ν¬ λ€μ—­ν­ λ³΄νΈ | Rate Limiting, WAF, API Gateway  |
| **2. μ‹ λ¶„ ν™•μΈ**  | "μ΄ μ‚¬λμ΄ 'λ„κµ¬'μΈμ§€ μ„λ²„κ°€ κΈ°μ–µν•΄μ•Ό ν•λ‚? (Stateful vs Stateless)" | μ„λ²„ RAM μμ› ν¨μ¨ν™”, μ—¬λ¬ μ„λ²„λ΅ μν‰ ν™•μ¥ μ©μ΄  | Session (RAM), JWT (CPU μ—°μ‚° κΈ°λ° ν† ν°) |
| **3. μ¤‘λ³µ μ²΄ν¬**  | "λ„¤νΈμ›ν¬κ°€ λκ²¨μ„ λ‘κ°™μ€ μ”μ²­μ΄ λ μ¤λ©΄ μ–΄λ–΅ν•μ§€?" | DB λ°μ΄ν„° λ¬΄κ²°μ„± λ³΄νΈ, μ¤‘λ³µ κ²°μ  λ°©μ§€  | Idempotency Key, Redis, Unique Key |
| **4. λ°μ΄ν„° μ ‘κ·Ό** | "DBμ—μ„ λ°μ΄ν„°λ¥Ό μ–΄λ–»κ² κ°€μ Έμ¬κΉ? JOINμ΄ λ„λ¬΄ λ§μ§„ μ•λ‚?" | Disk I/O μµμ†ν™”, DB μ„λ²„ Lock μµμ†ν™”    | Indexing, Cursor Pagination, Query Tuning |
| **5. μΊμ‹ νλ³„**  | "μ΄κ±° κΌ­ DBκΉμ§€ κ°€μ•Ό ν•΄? μ•„κΉ μ¤€ κ±°λ‘ λ‘κ°™μ€λ°?" | DB λ¶€λ‹΄ κ°μ†, μ‘λ‹µ μ†λ„ κ·Ήλ€ν™”  | ETag, Redis Cache, Cache-Control  |
| **6. κ²°κ³Ό λ°ν™**  | "ν΄λΌμ΄μ–ΈνΈκ°€ μ΄ κ²°κ³Όλ¥Ό μ–΄λ–»κ² ν•΄μ„ν•κ² ν• κΉ?" | ν‘μ¤€ν™”λ ν†µμ‹ μΌλ΅ ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ μ»¤λ®¤λ‹μΌ€μ΄μ… λΉ„μ© μ κ° | HTTP Status Code (201, 409, 422 λ“±) |
| **7. λ’·μ •λ¦¬**    | "μ§„μ§ μ§€μΈκΉ? μ•„λ‹λ©΄ μ§€μ› λ‹¤κ³  ν‘μ‹λ§ ν• κΉ?"| λ°μ΄ν„° λ³µκµ¬ κ°€λ¥μ„± ν™•λ³΄, ν†µκ³„ μΌκ΄€μ„± μ μ§€ | Soft Delete (`is_deleted`), Hard Delete   |
---